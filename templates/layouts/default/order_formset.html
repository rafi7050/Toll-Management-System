{% load crispy_forms_tags static %}
<div class="form_set_container">
    {{ formset.management_form|crispy }}
    {% for form in formset.forms %}
        <div class="{% cycle 'row1' 'row2' %} formset_row-{{ formset.prefix }} row p-0 m-0">
            {% for field in form.visible_fields %}
                {% if not field.name == 'DELETE' %}
                    {% if field.name in 'price,quantity' %}
                         <div class="col-1 {{ field.name }}_select">
                            {# Include the hidden fields in the form #}
                            {% if forloop.first %}
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            {% endif %}
                            {{ field.errors.as_ul }}
                            {{ field|as_crispy_field }}
                        </div>
                    {% elif field.name in 'item_type,total_price' %}
                        <div class="col-2 {{ field.name }}_select">
                            {# Include the hidden fields in the form #}
                            {% if forloop.first %}
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            {% endif %}
                            {{ field.errors.as_ul }}
                            {{ field|as_crispy_field }}
                        </div>
                    {% else %}
                        <div class="col {{ field.name }}_select">
                            {# Include the hidden fields in the form #}
                            {% if forloop.first %}
                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            {% endif %}
                            {{ field.errors.as_ul }}
                            {{ field|as_crispy_field }}
                        </div>
                    {% endif %}

                {% endif %}
            {% endfor %}
        </div>
    {% endfor %}
</div>
<br>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.formset/1.2.2/jquery.formset.js"></script>
<script type="text/javascript">
    $('.formset_row-{{ formset.prefix }}').formset({
        addText: '<button class="btn btn-success rounded-0 btn-md">+</button>',
        deleteText: '<button class="btn btn-danger rounded-0 btn-md">-</button>',
        {#deleteCssClass: 'delete-row justify-content-center align-self-center',#}
        prefix: '{{ formset.prefix }}',
        animateForms: true,
        removed: function () {
            calculate_total_price()
        },
        added: function () {
            new_row_set()
        }
    });

    let calculate_total_price = function () {
        let total_amount = 0
        $('.total_price_select input').each(function () {
            let price = parseFloat($(this).val())
            total_amount += price
        })

        $('[name="total_amount"]').val(total_amount)
    }

    let new_row_set = function () {
        let __this = $('.dynamic-form:last')
        __this.find('.package_select').find('option').prop('selected', false)
        __this.find('.product_select').find('option').prop('selected', false)
        let item_type = __this.find('.item_type_select select').val()
        if (item_type == 2) {
            __this.find('.package_select').hide().find('select').prop('disabled', true)
            __this.find('.product_select').show().find('select').select2()
        } else {
            __this.find('.package_select').show().find('select').select2()
            __this.find('.product_select').hide().find('select').prop('disabled', true)
        }
        __this.find('.quantity_select').find('input').val(1)
    }
</script>